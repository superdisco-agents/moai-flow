# MOAI-ADK 의사결정 프레임워크

## 개요

MOAI-ADK 의사결정 프레임워크는 AI 애플리케이션에 최적화된 에이전트 아키텍처 패턴을 선택하기 위한 체계적인 접근법을 제공합니다. 이 프레임워크는 개발자가 다양한 오케스트레이션 방법, 조정 전략, 실행 모델 중에서 프로젝트 요구사항, 제약조건, 목표에 기반하여 최적의 선택을 할 수 있도록 안내합니다.

획일적인 솔루션을 제시하는 대신, 이 프레임워크는 명확한 평가 기준을 통한 의사결정을 강조합니다. 작업 복잡도, 조정 필요성, 확장성 요구사항, 장애 허용성 등 애플리케이션 특성을 이해하여 가장 적합한 아키텍처 패턴에 도달하도록 안내합니다. 이 프레임워크는 실용적이고 실행 가능하며 실제 사용 사례에 기반합니다.

새로운 AI 에이전트 프로젝트를 시작하거나, 기존 에이전트 시스템을 리팩토링하거나, 아키텍처 패턴 전환을 평가할 때 이 가이드를 활용하세요. 상세한 분석 문서를 보완하며 아키텍처 의사결정을 위한 빠른 참조를 제공합니다.

---

## 의사결정 순서도

```
시작: 에이전트 요구사항 정의
│
├─→ 단일 작업, 순차 흐름?
│   ├─ 예 → Sequential Chain 사용 (LangGraph)
│   │         ├─ 상태 영속성 필요? → 체크포인트 추가
│   │         └─ 사람 승인 필요? → 브레이크포인트 추가
│   │
│   └─ 아니오 → 계속 ↓
│
├─→ 여러 독립 작업?
│   ├─ 예 → 병렬 실행 사용
│   │         ├─ 작업이 컨텍스트 공유? → Swarm 사용 (claude-flow)
│   │         └─ 작업이 격리됨? → Tool Calling 사용 (MCP)
│   │
│   └─ 아니오 → 계속 ↓
│
├─→ 동적 작업 라우팅 필요?
│   ├─ 예 → Agent Router 패턴 사용
│   │         ├─ 조정 필요? → Swarm Router
│   │         └─ 단순 디스패치? → LangGraph Router
│   │
│   └─ 아니오 → 계속 ↓
│
├─→ 복잡한 멀티-에이전트 협업?
│   ├─ 예 → 계층적 조정 사용
│   │         ├─ 합의 필요? → Byzantine/Raft (claude-flow)
│   │         ├─ 메모리 필요? → Shared Memory Swarm
│   │         └─ 자율성 필요? → Mesh Topology
│   │
│   └─ 아니오 → 계속 ↓
│
└─→ 실시간 적응 필요?
    ├─ 예 → Reactive Swarm 사용 (claude-flow)
    └─ 아니오 → 요구사항 재평가 또는 Hybrid 사용
```

---

## 비교 매트릭스

| 기준 | Sequential Chain | Parallel Execution | Agent Router | Hierarchical Swarm | Reactive Swarm |
|----------|------------------|-------------------|--------------|-------------------|----------------|
| **작업 복잡도** | 낮음-중간 | 낮음-중간 | 중간 | 높음 | 매우 높음 |
| **조정 필요성** | 최소 | 없음-낮음 | 중간 | 높음 | 매우 높음 |
| **확장성** | 낮음 | 높음 | 중간 | 높음 | 매우 높음 |
| **장애 복구** | 수동 | 수동 | 자동 | 자가치유 | 자가치유 |
| **학습 능력** | 없음 | 없음 | 제한적 | 중간 | 높음 |
| **설정 복잡도** | 낮음 | 낮음 | 중간 | 높음 | 매우 높음 |
| **최적 용도** | 워크플로우 | 배치 작업 | 라우팅 | 팀 | 적응형 시스템 |
| **주요 도구** | LangGraph | MCP/claude-flow | 둘 다 | claude-flow | claude-flow |
| **상태 관리** | 중앙집중 | 분산 | 하이브리드 | 분산 | 분산 |
| **성능** | 순차 | 병렬 | 혼합 | 병렬 | 병렬 + 학습 |

---

## 사용 가이드

### 1. 작업 특성 평가

**질문:**
- 단일 워크플로우인가 여러 독립 작업인가?
- 작업이 컨텍스트를 공유해야 하는가 격리 실행인가?
- 실행 순서가 고정인가 동적인가?
- 작업이 서로의 결과를 기다려야 하는가?

**의사결정 포인트:**
- 단일 워크플로우 + 고정 순서 → Sequential Chain
- 여러 작업 + 의존성 없음 → Parallel Execution
- 여러 작업 + 공유 컨텍스트 → Swarm Coordination
- 동적 의존성 → Agent Router 또는 Hierarchical

---

### 2. 조정 요구사항 평가

**질문:**
- 에이전트가 실행 중 통신이 필요한가?
- 의사결정에 합의가 필요한가?
- 에이전트가 메모리나 상태를 공유해야 하는가?
- 에이전트가 서로를 인식해야 하는가?

**의사결정 포인트:**
- 통신 불필요 → Tool Calling (MCP)
- 단순 핸드오프 → Sequential Chain (LangGraph)
- 능동적 협업 → Swarm (claude-flow)
- 합의 필요 → Byzantine/Raft Swarm

---

### 3. 확장성 요구사항 고려

**질문:**
- 몇 개의 에이전트가 동시 실행되는가?
- 에이전트 수가 시간에 따라 증가하는가?
- 동적 에이전트 스포닝이 필요한가?
- 로드 밸런싱이 필요한가?

**의사결정 포인트:**
- 1-3 에이전트, 고정 → LangGraph Parallel
- 4-10 에이전트, 동적 → claude-flow Swarm
- 10+ 에이전트, 자동 확장 → Hierarchical Swarm
- 배치 처리 → Parallel Tool Calling

---

### 4. 장애 허용성 결정

**질문:**
- 하나의 에이전트가 실패하면 어떻게 되는가?
- 재시도 로직이 필요한가?
- 시스템이 자가치유해야 하는가?
- 체크포인트가 필요한가?

**의사결정 포인트:**
- 수동 재시도 가능 → 기본 패턴
- 체크포인트 필요 → LangGraph with persistence
- 자가치유 필요 → claude-flow with fault tolerance
- 중요 신뢰성 → Byzantine Swarm

---

### 5. 향후 진화 계획

**질문:**
- 요구사항이 자주 변경되는가?
- 새로운 에이전트 타입을 추가해야 하는가?
- 시스템이 사용에서 학습해야 하는가?
- 다른 패턴으로 마이그레이션 가능성이 있는가?

**의사결정 포인트:**
- 안정적 요구사항 → 단순 패턴
- 빈번한 변경 → 모듈식 아키텍처
- 학습 필요 → Neural patterns (claude-flow)
- 불확실한 미래 → Hybrid 접근

---

## 의사결정 체크리스트

아키텍처 선택을 검증하기 위한 체크리스트:

- [ ] **작업 분석**: 작업이 순차, 병렬, 혼합인지 이해함
- [ ] **조정 수준**: 에이전트 간 통신 필요도를 파악함
- [ ] **확장성 목표**: 예상 동시 에이전트 수를 알고 있음 (현재 및 미래)
- [ ] **장애 전략**: 에이전트 실패나 타임아웃 시 동작을 정의함
- [ ] **상태 관리**: 에이전트 상태를 어디에 어떻게 저장할지 알고 있음
- [ ] **성능 목표**: 지연시간과 처리량 요구사항을 설정함
- [ ] **도구 선택**: LangGraph, MCP, claude-flow 기능을 평가함
- [ ] **학습 요구**: 시스템이 시간에 따라 적응해야 하는지 결정함
- [ ] **비용 제약**: 토큰 사용량과 인프라 비용을 고려함
- [ ] **팀 전문성**: 선택한 도구에 대한 팀의 숙련도를 평가함

---

## 실제 예제

### 예제 1: 콘텐츠 파이프라인 (Sequential Chain)

**사용 사례**: 리서치 → 작성 → 편집 → 발행 블로그 포스트 생성 파이프라인

**의사결정 근거:**
- 명확한 핸드오프가 있는 고정 순차 워크플로우
- 각 단계가 이전 출력에 의존
- 병렬화 불가능
- 발행 전 사람 검토 필요

**아키텍처 선택**: LangGraph Sequential Chain with breakpoints

**구현:**
```python
# 체크포인트가 있는 단순하고 명확한 워크플로우
workflow = StateGraph(BlogState)
workflow.add_node("research", research_agent)
workflow.add_node("write", writing_agent)
workflow.add_node("edit", editing_agent)
workflow.add_edge("research", "write")
workflow.add_edge("write", "edit")
workflow.add_conditional_edges("edit", human_review, {"approve": END})
```

---

### 예제 2: 데이터 분석 대시보드 (Parallel + Swarm)

**사용 사례**: 여러 데이터 소스를 동시 처리하는 실시간 분석 대시보드

**의사결정 근거:**
- 5개 이상의 독립 데이터 소스 (API, 데이터베이스, 파일)
- 소스를 병렬로 처리 가능
- 결과를 공유 컨텍스트로 집계 필요
- 하나의 소스 실패 시 장애 허용성 필요

**아키텍처 선택**: Hybrid (MCP for parallel fetching + claude-flow for aggregation)

**구현:**
```javascript
// MCP로 병렬 페칭, swarm으로 조정된 집계
// 단계 1: 병렬 데이터 페칭
await Promise.all([
  mcp.invoke("fetch_api_data"),
  mcp.invoke("fetch_db_data"),
  mcp.invoke("fetch_file_data")
]);

// 단계 2: 분석을 위한 Swarm 조정
await swarm.init({ topology: "mesh", agents: 3 });
await swarm.orchestrate("aggregate_and_analyze");
```

---

### 예제 3: 고객 지원 라우터 (Agent Router + Hierarchical)

**사용 사례**: 쿼리를 전문 에이전트로 라우팅하는 지능형 고객 지원 시스템

**의사결정 근거:**
- 쿼리 타입 기반 동적 라우팅 필요
- 10개 이상의 전문 에이전트 (청구, 기술, 영업 등)
- 복잡한 쿼리를 위한 에스컬레이션 경로
- 해결 패턴에서 학습

**아키텍처 선택**: Agent Router (LangGraph) + Hierarchical Swarm (claude-flow)

**구현:**
```python
# 초기 분류를 위한 라우터
router = LangGraph.create_router({
  "technical": technical_swarm,
  "billing": billing_swarm,
  "sales": sales_swarm,
  "complex": escalation_swarm
})

# 각 swarm은 코디네이터가 있는 계층 구조
technical_swarm = claudeflow.swarm_init({
  topology: "hierarchical",
  coordinator: "technical-lead",
  agents: ["network-expert", "security-expert", "database-expert"]
})
```

**핵심 패턴**: 라우터가 초기 디스패치를 처리하고, swarm이 도메인 내 복잡한 협업을 처리합니다.

---

## 요약

이 의사결정 프레임워크는 단일 패턴에 대한 교조적 고수보다 **실용적 선택**을 강조합니다. 최적의 아키텍처는:

1. **과도한 엔지니어링 없이 현재 요구사항을 충족**
2. **완전한 재작성 없이 성장과 함께 확장**
3. **유지보수를 위해 팀의 전문성과 일치**
4. **복잡성과 기능 간 적절한 균형**

단순하게 시작하세요. 요구사항이 요구할 때만 복잡성을 추가하세요. 이 프레임워크를 규칙집이 아닌 가이드로 사용하세요.

상세한 구현 안내는 다음을 참조하세요:
- `01-LANGGRAPH.md` - 순차 및 병렬 워크플로우
- `02-MCP.md` - 도구 기반 병렬화
- `03-CLAUDE-FLOW.md` - Swarm 조정 및 neural 기능
- `04-INTEGRATION.md` - Hybrid 패턴 및 마이그레이션
- `05-PRODUCTION.md` - 배포 및 모니터링

---

**문서 버전**: 1.0
**최종 업데이트**: 2025-11-28
**소속**: MOAI-ADK 분석 시리즈
