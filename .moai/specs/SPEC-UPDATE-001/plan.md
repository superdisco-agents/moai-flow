# SPEC-UPDATE-001: êµ¬í˜„ ê³„íš

> **TAG**: PLAN-UPDATE-001
> **ì—°ê´€ SPEC**: SPEC-UPDATE-001
> **ì‘ì„±ì¼**: 2025-11-27

---

## ğŸ“‹ êµ¬í˜„ ê°œìš”

moai-adk update ëª…ë ¹ì–´ì˜ ë°±ì—…/ë³µì› ê¸°ëŠ¥ì„ Skillsì—ì„œ Commands, Agents, Hooksë¡œ í™•ì¥í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ì ì •ì˜ íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ê³ , ëŒ€í™”í˜• UIë¥¼ í†µí•´ ì„ íƒì  ë³µì›ì„ ì§€ì›í•©ë‹ˆë‹¤.

**í•µì‹¬ ê°€ì¹˜**:
- âœ… ì‚¬ìš©ì ì •ì˜ íŒŒì¼ ë³´í˜¸ (Commands, Agents, Hooks)
- âœ… ì§ê´€ì ì¸ ë©€í‹°ì…€ë ‰íŠ¸ UI
- âœ… ì•ˆì „í•œ ì¶©ëŒ ë°©ì§€ ë¡œì§
- âœ… --yes í”Œë˜ê·¸ë¡œ ìë™í™” ì§€ì›

---

## ğŸ¯ êµ¬í˜„ ëª©í‘œ

### ì£¼ìš” ëª©í‘œ

1. **ì™„ì „í•œ ë°±ì—…/ë³µì› ì‹œìŠ¤í…œ**: Skillsë¿ë§Œ ì•„ë‹ˆë¼ Commands, Agents, Hooksë„ ë³´í˜¸
2. **ì¶©ëŒ ë°©ì§€**: í…œí”Œë¦¿ íŒŒì¼ê³¼ ì‚¬ìš©ì ì •ì˜ íŒŒì¼ ê°„ ì¶©ëŒì„ ìë™ ê°ì§€í•˜ê³  ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
3. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: questionary ê¸°ë°˜ ë©€í‹°ì…€ë ‰íŠ¸ UIë¡œ ì§ê´€ì ì¸ ë³µì› ì„ íƒ
4. **ìë™í™” ì§€ì›**: --yes í”Œë˜ê·¸ë¡œ CI/CD í™˜ê²½ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥

### ì„±ê³µ ê¸°ì¤€

- âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ â‰¥85%
- âœ… ëª¨ë“  íŒŒì¼ ìœ í˜• (Commands, Agents, Hooks, Skills) ë°±ì—…/ë³µì› ì§€ì›
- âœ… ì¶©ëŒ íŒŒì¼ 0% ë³µì› (í…œí”Œë¦¿ ë³´í˜¸)
- âœ… ì‚¬ìš©ì ì„ íƒ UI 100% ë™ì‘
- âœ… Ruff, mypy ë¦°íŒ… í†µê³¼

---

## ğŸ—ºï¸ êµ¬í˜„ ë‹¨ê³„

### Milestone 1: Detection í•¨ìˆ˜ êµ¬í˜„ (ìš°ì„ ìˆœìœ„: ìµœê³ )

**ëª©í‘œ**: ì‚¬ìš©ì ì •ì˜ íŒŒì¼ì„ ìë™ìœ¼ë¡œ íƒì§€í•˜ëŠ” í•µì‹¬ ë¡œì§ êµ¬í˜„

**ì‘ì—…**:

1. **detect_custom_commands() êµ¬í˜„**
   - ì…ë ¥: ì—†ìŒ
   - ì¶œë ¥: `List[Path]` - `.claude/commands/moai/` í•˜ìœ„ ì‚¬ìš©ì ì •ì˜ íŒŒì¼
   - ë¡œì§: í…œí”Œë¦¿ íŒ¨í‚¤ì§€ì™€ ë¹„êµí•˜ì—¬ ì°¨ì´ì  íƒì§€
   - ì˜ˆìƒ ì½”ë“œ: ~20 lines

2. **detect_custom_agents() êµ¬í˜„**
   - ì…ë ¥: ì—†ìŒ
   - ì¶œë ¥: `List[Path]` - `.claude/agents/` í•˜ìœ„ ì‚¬ìš©ì ì •ì˜ íŒŒì¼
   - ë¡œì§: í…œí”Œë¦¿ íŒ¨í‚¤ì§€ì™€ ë¹„êµí•˜ì—¬ ì°¨ì´ì  íƒì§€
   - ì˜ˆìƒ ì½”ë“œ: ~20 lines

3. **detect_custom_hooks() êµ¬í˜„**
   - ì…ë ¥: ì—†ìŒ
   - ì¶œë ¥: `List[Path]` - `.claude/hooks/moai/` í•˜ìœ„ ì‚¬ìš©ì ì •ì˜ íŒŒì¼
   - ë¡œì§: í…œí”Œë¦¿ íŒ¨í‚¤ì§€ì™€ ë¹„êµí•˜ì—¬ ì°¨ì´ì  íƒì§€
   - ì˜ˆìƒ ì½”ë“œ: ~20 lines

4. **get_template_files() í—¬í¼ í•¨ìˆ˜ êµ¬í˜„**
   - ì…ë ¥: `file_type: str` (ì˜ˆ: "commands/moai")
   - ì¶œë ¥: `Set[str]` - í…œí”Œë¦¿ íŒ¨í‚¤ì§€ì˜ íŒŒì¼ëª… ì§‘í•©
   - ë¡œì§: `src/moai_adk/templates/.claude/{file_type}` ìŠ¤ìº”
   - ì˜ˆìƒ ì½”ë“œ: ~15 lines

**ê²€ì¦ ê¸°ì¤€**:
- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: ê° detection í•¨ìˆ˜ë³„ í…ŒìŠ¤íŠ¸ (í…œí”Œë¦¿ íŒŒì¼ ì œì™¸, ì‚¬ìš©ì íŒŒì¼ í¬í•¨)
- âœ… ì—£ì§€ ì¼€ì´ìŠ¤: ë””ë ‰í† ë¦¬ ì—†ì„ ë•Œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
- âœ… ì„±ëŠ¥: O(n) ë³µì¡ë„ ìœ ì§€ (n = íŒŒì¼ ê°œìˆ˜)

**ì‚°ì¶œë¬¼**:
- `src/moai_adk/cli/commands/update.py` - detection í•¨ìˆ˜ ì¶”ê°€
- `tests/test_cli/test_update_detection.py` - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

---

### Milestone 2: Backup/Restore í•¨ìˆ˜ êµ¬í˜„ (ìš°ì„ ìˆœìœ„: ìµœê³ )

**ëª©í‘œ**: íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³  ë³µì›í•˜ëŠ” í•µì‹¬ ë¡œì§ êµ¬í˜„

**ì‘ì—…**:

1. **backup_files() êµ¬í˜„**
   - ì…ë ¥: `files: List[Path], backup_type: str`
   - ì¶œë ¥: ì—†ìŒ (ë¶€ìˆ˜íš¨ê³¼: íŒŒì¼ ë³µì‚¬)
   - ë¡œì§:
     - `.moai/backups/update/{backup_type}/` ë””ë ‰í† ë¦¬ ìƒì„±
     - ê° íŒŒì¼ì„ `shutil.copy2()`ë¡œ ë³µì‚¬
     - Rich consoleë¡œ ì§„í–‰ ìƒí™© ì¶œë ¥
   - ì˜ˆìƒ ì½”ë“œ: ~15 lines

2. **restore_files() êµ¬í˜„**
   - ì…ë ¥: `selected_types: List[str]`
   - ì¶œë ¥: `Dict[str, int]` - `{"restored": 3, "skipped": 1}`
   - ë¡œì§:
     - ê° `backup_type`ì— ëŒ€í•´ ë°±ì—… ë””ë ‰í† ë¦¬ ìŠ¤ìº”
     - ì¶©ëŒ ê²€ì‚¬: `is_template_file()` í˜¸ì¶œ
     - ì¶©ëŒ ì—†ìœ¼ë©´ ë³µì›, ì¶©ëŒ ìˆìœ¼ë©´ ìŠ¤í‚µ + ê²½ê³ 
   - ì˜ˆìƒ ì½”ë“œ: ~35 lines

3. **is_template_file() í—¬í¼ í•¨ìˆ˜ êµ¬í˜„**
   - ì…ë ¥: `file_type: str, file_name: str`
   - ì¶œë ¥: `bool` - í…œí”Œë¦¿ íŒŒì¼ ì—¬ë¶€
   - ë¡œì§: `src/moai_adk/templates/.claude/{file_type}/{file_name}` ì¡´ì¬ í™•ì¸
   - ì˜ˆìƒ ì½”ë“œ: ~20 lines

**ê²€ì¦ ê¸°ì¤€**:
- âœ… ë°±ì—… í…ŒìŠ¤íŠ¸: íŒŒì¼ì´ `.moai/backups/update/` í•˜ìœ„ì— ì •í™•íˆ ë³µì‚¬ë˜ëŠ”ì§€ í™•ì¸
- âœ… ë³µì› í…ŒìŠ¤íŠ¸: ì„ íƒëœ íŒŒì¼ë§Œ ë³µì›ë˜ëŠ”ì§€ í™•ì¸
- âœ… ì¶©ëŒ í…ŒìŠ¤íŠ¸: í…œí”Œë¦¿ íŒŒì¼ ë³µì› ì‹œ ìŠ¤í‚µë˜ëŠ”ì§€ í™•ì¸
- âœ… ì—ëŸ¬ í•¸ë“¤ë§: ê¶Œí•œ ì—†ëŠ” íŒŒì¼ ë³µì‚¬ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬

**ì‚°ì¶œë¬¼**:
- `src/moai_adk/cli/commands/update.py` - backup/restore í•¨ìˆ˜ ì¶”ê°€
- `tests/test_cli/test_update_backup.py` - ë°±ì—… í…ŒìŠ¤íŠ¸
- `tests/test_cli/test_update_restore.py` - ë³µì› í…ŒìŠ¤íŠ¸

---

### Milestone 3: UI í†µí•© (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

**ëª©í‘œ**: questionary ê¸°ë°˜ ë©€í‹°ì…€ë ‰íŠ¸ UIë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

**ì‘ì—…**:

1. **show_restoration_prompt() êµ¬í˜„**
   - ì…ë ¥: ì—†ìŒ
   - ì¶œë ¥: `List[str]` - ì„ íƒëœ íŒŒì¼ ìœ í˜• (ì˜ˆ: `["commands", "agents"]`)
   - ë¡œì§:
     - ë°±ì—… íŒŒì¼ì´ ìˆëŠ” ìœ í˜•ë§Œ ì„ íƒì§€ì— ì¶”ê°€
     - `questionary.checkbox()` í˜¸ì¶œ
     - ì‚¬ìš©ì ì„ íƒ ë°˜í™˜
   - ì˜ˆìƒ ì½”ë“œ: ~25 lines

2. **has_backups() í—¬í¼ í•¨ìˆ˜ êµ¬í˜„**
   - ì…ë ¥: `backup_type: str`
   - ì¶œë ¥: `bool` - ë°±ì—… íŒŒì¼ ì¡´ì¬ ì—¬ë¶€
   - ë¡œì§: `.moai/backups/update/{backup_type}/` ë””ë ‰í† ë¦¬ì— íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
   - ì˜ˆìƒ ì½”ë“œ: ~10 lines

3. **Rich ì½˜ì†” ì¶œë ¥ ê°œì„ **
   - ë°±ì—… ì§„í–‰ ìƒí™©: `[green]âœ“[/green] Backed up: {file_name}`
   - ë³µì› ì§„í–‰ ìƒí™©: `[green]âœ“[/green] Restored: {file_name}`
   - ì¶©ëŒ ê²½ê³ : `[yellow]âš [/yellow] Skipping {file_name}: conflicts with template`
   - ë³µì› ê²°ê³¼ ìš”ì•½: `[green]âœ“[/green] Restoration complete: 3 files restored, 1 skipped.`

**ê²€ì¦ ê¸°ì¤€**:
- âœ… UI í…ŒìŠ¤íŠ¸: questionary mockì„ í†µí•´ ì„ íƒ ì‹œë®¬ë ˆì´ì…˜
- âœ… ì—£ì§€ ì¼€ì´ìŠ¤: ë°±ì—… íŒŒì¼ ì—†ì„ ë•Œ í”„ë¡¬í”„íŠ¸ í‘œì‹œ ì•ˆ í•¨
- âœ… --yes í”Œë˜ê·¸ í…ŒìŠ¤íŠ¸: í”„ë¡¬í”„íŠ¸ ì—†ì´ ìë™ ë³µì›

**ì‚°ì¶œë¬¼**:
- `src/moai_adk/cli/commands/update.py` - UI í•¨ìˆ˜ ì¶”ê°€
- `tests/test_cli/test_update_ui.py` - UI í†µí•© í…ŒìŠ¤íŠ¸

---

### Milestone 4: í†µí•© ë° í…ŒìŠ¤íŠ¸ (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

**ëª©í‘œ**: ì „ì²´ ì›Œí¬í”Œë¡œìš° í†µí•© ë° end-to-end í…ŒìŠ¤íŠ¸

**ì‘ì—…**:

1. **_handle_restoration() ë¦¬íŒ©í† ë§**
   - ê¸°ì¡´ Skills ë°±ì—…/ë³µì› ë¡œì§ì„ ìƒˆë¡œìš´ í•¨ìˆ˜ë“¤ë¡œ êµì²´
   - Commands, Agents, Hooks ë°±ì—…/ë³µì› ì¶”ê°€
   - --yes í”Œë˜ê·¸ ì²˜ë¦¬ ë¡œì§ í†µí•©
   - ì˜ˆìƒ ì½”ë“œ: ~50 lines (ê¸°ì¡´ ì½”ë“œ êµì²´)

2. **End-to-End í…ŒìŠ¤íŠ¸ ì‘ì„±**
   - ì‹œë‚˜ë¦¬ì˜¤ 1: Commandsë§Œ ë°±ì—…/ë³µì›
   - ì‹œë‚˜ë¦¬ì˜¤ 2: Agents, Hooks ë™ì‹œ ë°±ì—…/ë³µì›
   - ì‹œë‚˜ë¦¬ì˜¤ 3: ì¶©ëŒ íŒŒì¼ ì²˜ë¦¬
   - ì‹œë‚˜ë¦¬ì˜¤ 4: --yes í”Œë˜ê·¸ë¡œ ìë™ ë³µì›
   - ì‹œë‚˜ë¦¬ì˜¤ 5: ë°±ì—… íŒŒì¼ ì—†ì„ ë•Œ ì²˜ë¦¬

3. **ë¬¸ì„œí™”**
   - `update.py` docstring ì—…ë°ì´íŠ¸
   - ê° í•¨ìˆ˜ì— type hints ì¶”ê°€
   - README ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ë°±ì—…/ë³µì› ê¸°ëŠ¥ ì„¤ëª…)

**ê²€ì¦ ê¸°ì¤€**:
- âœ… í†µí•© í…ŒìŠ¤íŠ¸: ì „ì²´ ì›Œí¬í”Œë¡œìš° ì‹œë®¬ë ˆì´ì…˜
- âœ… ì½”ë“œ ì»¤ë²„ë¦¬ì§€: â‰¥85%
- âœ… ë¦°íŒ…: `ruff check src/`, `mypy src/` í†µê³¼
- âœ… ë¬¸ì„œí™”: ëª¨ë“  í•¨ìˆ˜ì— docstring ë° type hints

**ì‚°ì¶œë¬¼**:
- `src/moai_adk/cli/commands/update.py` - ì™„ì„±ëœ í†µí•© ì½”ë“œ
- `tests/test_cli/test_update_e2e.py` - End-to-End í…ŒìŠ¤íŠ¸
- `README.md` - ê¸°ëŠ¥ ì„¤ëª… ì—…ë°ì´íŠ¸

---

## ğŸ› ï¸ ê¸°ìˆ  ì ‘ê·¼ ë°©ë²•

### ì„¤ê³„ ì›ì¹™

1. **ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)**: ê° í•¨ìˆ˜ëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ì„ë§Œ ê°€ì§
   - Detection: `detect_custom_*()` í•¨ìˆ˜
   - Backup: `backup_files()` í•¨ìˆ˜
   - Restore: `restore_files()` í•¨ìˆ˜
   - UI: `show_restoration_prompt()` í•¨ìˆ˜

2. **ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ (DIP)**: í…œí”Œë¦¿ íŒŒì¼ ê²½ë¡œë¥¼ í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³  í—¬í¼ í•¨ìˆ˜ë¡œ ì¶”ìƒí™”
   - `get_template_files(file_type)` - í…œí”Œë¦¿ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
   - `is_template_file(file_type, file_name)` - í…œí”Œë¦¿ íŒŒì¼ ì—¬ë¶€ í™•ì¸

3. **ì—´ë¦°-ë‹«íŒ ì›ì¹™ (OCP)**: ìƒˆë¡œìš´ íŒŒì¼ ìœ í˜• ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”
   - `file_type_map` ë”•ì…”ë„ˆë¦¬ë¡œ íŒŒì¼ ìœ í˜• ë§¤í•‘
   - ìƒˆë¡œìš´ ìœ í˜• ì¶”ê°€ ì‹œ ë”•ì…”ë„ˆë¦¬ì—ë§Œ í•­ëª© ì¶”ê°€

### ì•„í‚¤í…ì²˜ íŒ¨í„´

**Strategy Pattern**: ë°±ì—…/ë³µì› ëŒ€ìƒì„ ë™ì ìœ¼ë¡œ ì„ íƒ
```python
backup_strategies = {
    "commands": detect_custom_commands,
    "agents": detect_custom_agents,
    "hooks": detect_custom_hooks,
    "skills": detect_custom_skills
}

for file_type, strategy in backup_strategies.items():
    files = strategy()
    if files:
        backup_files(files, file_type)
```

**Template Method Pattern**: ë°±ì—…/ë³µì› ì›Œí¬í”Œë¡œìš° í‘œì¤€í™”
```python
def update_workflow(yes: bool):
    # 1. Detection
    custom_files = detect_all_custom_files()

    # 2. Backup
    backup_all_files(custom_files)

    # 3. Update
    sync_templates()

    # 4. Restore
    if yes:
        restore_all_files()
    else:
        selected = show_restoration_prompt()
        restore_selected_files(selected)
```

### ì—ëŸ¬ í•¸ë“¤ë§ ì „ëµ

| ì—ëŸ¬ ìœ í˜• | ì²˜ë¦¬ ë°©ë²• | ë³µêµ¬ ì „ëµ |
|----------|----------|----------|
| **íŒŒì¼ ê¶Œí•œ ì—ëŸ¬** | `try/except PermissionError` | í•´ë‹¹ íŒŒì¼ ìŠ¤í‚µ + ê²½ê³  ë¡œê·¸ |
| **ë””ë ‰í† ë¦¬ ìƒì„± ì‹¤íŒ¨** | `Path.mkdir(exist_ok=True)` | ë¶€ëª¨ ë””ë ‰í† ë¦¬ ìë™ ìƒì„± |
| **í…œí”Œë¦¿ íŒŒì¼ ì¶©ëŒ** | `is_template_file()` ì‚¬ì „ ê²€ì‚¬ | ë³µì› ìŠ¤í‚µ + ê²½ê³  ë©”ì‹œì§€ |
| **ë°±ì—… íŒŒì¼ ì—†ìŒ** | `has_backups()` ì‚¬ì „ ê²€ì‚¬ | ë³µì› ë‹¨ê³„ ê±´ë„ˆë›°ê¸° |

### ì„±ëŠ¥ ìµœì í™”

1. **Lazy Evaluation**: ë°±ì—… íŒŒì¼ì´ ì—†ìœ¼ë©´ detection ìŠ¤í‚µ
2. **Batch Processing**: íŒŒì¼ ìœ í˜•ë³„ë¡œ ì¼ê´„ ë°±ì—…/ë³µì›
3. **Early Return**: ì‚¬ìš©ì ì •ì˜ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜

```python
# Before (ë¹„íš¨ìœ¨)
all_files = detect_all_files()
if all_files:
    backup(all_files)

# After (íš¨ìœ¨)
for file_type in ["commands", "agents", "hooks"]:
    files = detect_custom_files(file_type)
    if not files:
        continue  # Early return
    backup_files(files, file_type)
```

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ì„¤ê³„

### íŒŒì¼ êµ¬ì¡°

```
src/moai_adk/cli/commands/
â””â”€â”€ update.py (ìˆ˜ì •)
    â”œâ”€â”€ detect_custom_commands()      # NEW
    â”œâ”€â”€ detect_custom_agents()        # NEW
    â”œâ”€â”€ detect_custom_hooks()         # NEW
    â”œâ”€â”€ detect_custom_skills()        # ê¸°ì¡´
    â”œâ”€â”€ backup_files()                # NEW (ê¸°ì¡´ ë¡œì§ í™•ì¥)
    â”œâ”€â”€ restore_files()               # NEW (ê¸°ì¡´ ë¡œì§ í™•ì¥)
    â”œâ”€â”€ show_restoration_prompt()     # NEW
    â”œâ”€â”€ is_template_file()            # NEW
    â”œâ”€â”€ get_template_files()          # NEW
    â”œâ”€â”€ has_backups()                 # NEW
    â””â”€â”€ _handle_restoration()         # ìˆ˜ì • (í†µí•©)
```

### ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Detection Phase                                      â”‚
â”‚    Input: ì—†ìŒ                                           â”‚
â”‚    Output: Dict[str, List[Path]]                        â”‚
â”‚    {                                                     â”‚
â”‚      "commands": [Path("custom-cmd.md")],               â”‚
â”‚      "agents": [Path("custom-agent.md")],               â”‚
â”‚      "hooks": [Path("custom-hook.py")],                 â”‚
â”‚      "skills": [Path("custom-skill/")]                  â”‚
â”‚    }                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backup Phase                                         â”‚
â”‚    Input: Dict[str, List[Path]]                         â”‚
â”‚    Output: None (íŒŒì¼ ë³µì‚¬ ë¶€ìˆ˜íš¨ê³¼)                      â”‚
â”‚    .moai/backups/update/                                â”‚
â”‚    â”œâ”€â”€ commands/                                         â”‚
â”‚    â”‚   â””â”€â”€ custom-cmd.md                                â”‚
â”‚    â”œâ”€â”€ agents/                                           â”‚
â”‚    â”‚   â””â”€â”€ custom-agent.md                              â”‚
â”‚    â”œâ”€â”€ hooks/                                            â”‚
â”‚    â”‚   â””â”€â”€ custom-hook.py                               â”‚
â”‚    â””â”€â”€ skills/                                           â”‚
â”‚        â””â”€â”€ custom-skill/                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Update Phase                                         â”‚
â”‚    sync_templates() - ê¸°ì¡´ ë¡œì§                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Restoration Phase                                    â”‚
â”‚    Input: --yes í”Œë˜ê·¸ or ì‚¬ìš©ì ì„ íƒ                     â”‚
â”‚    Output: Dict[str, int] {"restored": 3, "skipped": 1} â”‚
â”‚    .claude/                                             â”‚
â”‚    â”œâ”€â”€ commands/moai/custom-cmd.md     [ë³µì›ë¨]         â”‚
â”‚    â”œâ”€â”€ agents/custom-agent.md          [ë³µì›ë¨]         â”‚
â”‚    â””â”€â”€ hooks/moai/custom-hook.py       [ë³µì›ë¨]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì˜ì¡´ì„± ê·¸ë˜í”„

```
update.py
â”œâ”€â”€ questionary (ëŒ€í™”í˜• UI)
â”‚   â””â”€â”€ checkbox() - ë©€í‹°ì…€ë ‰íŠ¸ í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ rich (ì½˜ì†” ì¶œë ¥)
â”‚   â””â”€â”€ Console.print() - ìƒ‰ìƒ/í¬ë§· ì¶œë ¥
â”œâ”€â”€ pathlib (ê²½ë¡œ ì²˜ë¦¬)
â”‚   â”œâ”€â”€ Path.mkdir() - ë””ë ‰í† ë¦¬ ìƒì„±
â”‚   â”œâ”€â”€ Path.glob() - íŒŒì¼ ìŠ¤ìº”
â”‚   â””â”€â”€ Path.exists() - íŒŒì¼ ì¡´ì¬ í™•ì¸
â””â”€â”€ shutil (íŒŒì¼ ë³µì‚¬)
    â””â”€â”€ copy2() - ë©”íƒ€ë°ì´í„° ë³´ì¡´ ë³µì‚¬
```

---

## âš ï¸ ìœ„í—˜ ë° ëŒ€ì‘ ê³„íš

### ìœ„í—˜ 1: í…œí”Œë¦¿ íŒŒì¼ ë®ì–´ì“°ê¸°

**ìœ„í—˜ë„**: ë†’ìŒ
**ì˜í–¥**: ì—…ë°ì´íŠ¸ í›„ í…œí”Œë¦¿ íŒŒì¼ì´ ì‚¬ìš©ì ì •ì˜ íŒŒì¼ë¡œ ë®ì–´ì¨ì§ â†’ ì‹œìŠ¤í…œ ì˜¤ì‘ë™

**ëŒ€ì‘ ê³„íš**:
- âœ… **ì˜ˆë°©**: `is_template_file()` í•¨ìˆ˜ë¡œ ì¶©ëŒ ì‚¬ì „ ê²€ì‚¬
- âœ… **íƒì§€**: ë³µì› ì „ í…œí”Œë¦¿ íŒŒì¼ ëª©ë¡ê³¼ ë¹„êµ
- âœ… **ë³µêµ¬**: ì¶©ëŒ íŒŒì¼ì€ ë³µì› ìŠ¤í‚µ + ê²½ê³  ë¡œê·¸ ì¶œë ¥

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
```python
def test_conflict_detection():
    # Given: í…œí”Œë¦¿ì— ì¡´ì¬í•˜ëŠ” íŒŒì¼ì„ ë°±ì—…
    backup_files([Path(".claude/commands/moai/1-plan.md")], "commands")

    # When: ë³µì› ì‹œë„
    results = restore_files(["commands"])

    # Then: ë³µì› ìŠ¤í‚µë˜ì–´ì•¼ í•¨
    assert results["skipped"] == 1
    assert not Path(".claude/commands/moai/1-plan.md").read_text().startswith("# Custom")
```

---

### ìœ„í—˜ 2: ë°±ì—… íŒŒì¼ ì†ì‹¤

**ìœ„í—˜ë„**: ì¤‘ê°„
**ì˜í–¥**: ì—…ë°ì´íŠ¸ ì¤‘ ì‹œìŠ¤í…œ ì¢…ë£Œ ì‹œ ë°±ì—… íŒŒì¼ ì†ì‹¤ â†’ ì‚¬ìš©ì ì •ì˜ íŒŒì¼ ì˜êµ¬ ì‚­ì œ

**ëŒ€ì‘ ê³„íš**:
- âœ… **ì˜ˆë°©**: ë°±ì—… ë‹¨ê³„ë¥¼ ì—…ë°ì´íŠ¸ ì „ì— ì™„ë£Œ
- âœ… **ë³µêµ¬**: `.moai/backups/update/` ë””ë ‰í† ë¦¬ë¥¼ ìˆ˜ë™ ë³µì› ê°€ì´ë“œ ì œê³µ
- âœ… **ì™„í™”**: ë°±ì—… ë””ë ‰í† ë¦¬ë¥¼ `.gitignore`ì—ì„œ ì œì™¸ (ì„ íƒì )

**ë°±ì—… ìˆœì„œ**:
```
1. detect_custom_files()
2. backup_files()         â† ì´ ì‹œì ì—ì„œ ë°±ì—… ì™„ë£Œ
3. sync_templates()        â† ì—…ë°ì´íŠ¸ ì‹œì‘ (ì¤‘ë‹¨ ê°€ëŠ¥)
4. restore_files()
```

---

### ìœ„í—˜ 3: UI í”„ë¡¬í”„íŠ¸ ë¬´ì‘ë‹µ

**ìœ„í—˜ë„**: ë‚®ìŒ
**ì˜í–¥**: questionary í”„ë¡¬í”„íŠ¸ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŒ â†’ ì‚¬ìš©ì ëŒ€ê¸°

**ëŒ€ì‘ ê³„íš**:
- âœ… **ì˜ˆë°©**: `--yes` í”Œë˜ê·¸ë¡œ ìë™í™” ëª¨ë“œ ì œê³µ
- âœ… **ì™„í™”**: í”„ë¡¬í”„íŠ¸ íƒ€ì„ì•„ì›ƒ ì„¤ì • (ì„ íƒì )
- âœ… **íšŒí”¼**: CI/CD í™˜ê²½ì—ì„œ `--yes` í”Œë˜ê·¸ ì‚¬ìš©

**ìë™í™” ëª¨ë“œ**:
```bash
# ëŒ€í™”í˜• ëª¨ë“œ (ê¸°ë³¸)
moai-adk update

# ìë™í™” ëª¨ë“œ (CI/CD)
moai-adk update --yes
```

---

## ğŸ“Š ë¦¬ì†ŒìŠ¤ ìš”êµ¬ì‚¬í•­

### ê°œë°œ ë¦¬ì†ŒìŠ¤

- **ê°œë°œì**: 1ëª… (Python ê°œë°œ ê²½í—˜ í•„ìˆ˜)
- **ì½”ë“œ ë¼ì¸ ìˆ˜**: ì•½ 200 lines (ì‹ ê·œ ì¶”ê°€)
- **í…ŒìŠ¤íŠ¸ ì½”ë“œ**: ì•½ 150 lines

### ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤

- **ë””ìŠ¤í¬ ê³µê°„**: `.moai/backups/update/` ë””ë ‰í† ë¦¬ (íŒŒì¼ í¬ê¸°ì˜ 2ë°°, ì¼ë°˜ì ìœ¼ë¡œ <1MB)
- **ë©”ëª¨ë¦¬**: ì¶”ê°€ ë©”ëª¨ë¦¬ ìš”êµ¬ì‚¬í•­ ì—†ìŒ (íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë° ë³µì‚¬)
- **CPU**: íŒŒì¼ ë³µì‚¬ ì‘ì—… (ì¼ë°˜ì ìœ¼ë¡œ <1ì´ˆ)

### ì™¸ë¶€ ì˜ì¡´ì„±

- **questionary**: `>=2.0.0` (ëŒ€í™”í˜• UI)
- **rich**: `>=13.0.0` (ì½˜ì†” ì¶œë ¥)
- **Python**: `>=3.9` (type hints ì§€ì›)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Tests)

**ëŒ€ìƒ í•¨ìˆ˜**:
- `detect_custom_commands()`
- `detect_custom_agents()`
- `detect_custom_hooks()`
- `backup_files()`
- `restore_files()`
- `is_template_file()`

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
- âœ… ì •ìƒ ê²½ë¡œ: ì‚¬ìš©ì ì •ì˜ íŒŒì¼ ì •í™•íˆ íƒì§€
- âœ… ì—£ì§€ ì¼€ì´ìŠ¤: ë””ë ‰í† ë¦¬ ì—†ì„ ë•Œ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
- âœ… ì—ëŸ¬ ì¼€ì´ìŠ¤: ê¶Œí•œ ì—†ëŠ” íŒŒì¼ ë³µì‚¬ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**: â‰¥90%

---

### í†µí•© í…ŒìŠ¤íŠ¸ (Integration Tests)

**ì‹œë‚˜ë¦¬ì˜¤**:
1. **Commands ë°±ì—…/ë³µì›**
2. **Agents ë°±ì—…/ë³µì›**
3. **Hooks ë°±ì—…/ë³µì›**
4. **ì—¬ëŸ¬ íŒŒì¼ ìœ í˜• ë™ì‹œ ë³µì›**
5. **--yes í”Œë˜ê·¸ ì²˜ë¦¬**

**í…ŒìŠ¤íŠ¸ í™˜ê²½**:
- ì„ì‹œ ë””ë ‰í† ë¦¬ì— `.claude/` ë° `.moai/` êµ¬ì¡° ìƒì„±
- í…œí”Œë¦¿ íŒ¨í‚¤ì§€ ëª¨í‚¹

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**: â‰¥85%

---

### End-to-End í…ŒìŠ¤íŠ¸ (E2E Tests)

**ì‹œë‚˜ë¦¬ì˜¤**:
1. **ì „ì²´ ì›Œí¬í”Œë¡œìš°**: detection â†’ backup â†’ update â†’ restore
2. **ì¶©ëŒ ì²˜ë¦¬**: í…œí”Œë¦¿ íŒŒì¼ê³¼ ì¶©ëŒ ì‹œ ë³µì› ìŠ¤í‚µ
3. **ë°±ì—… íŒŒì¼ ì—†ìŒ**: ë³µì› ë‹¨ê³„ ê±´ë„ˆë›°ê¸°

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
- ì‹¤ì œ `moai-adk update` ëª…ë ¹ì–´ ì‹¤í–‰
- `subprocess.run()`ìœ¼ë¡œ CLI í˜¸ì¶œ
- ê²°ê³¼ íŒŒì¼ ì‹œìŠ¤í…œ ê²€ì¦

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ**: â‰¥80%

---

## ğŸ”„ íƒ€ì„ë¼ì¸

> **ì°¸ê³ **: ì‹œê°„ ì˜ˆì¸¡ì€ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (TRUST ì›ì¹™ ì¤€ìˆ˜). ìš°ì„ ìˆœìœ„ì™€ ì˜ì¡´ì„±ë§Œ ëª…ì‹œí•©ë‹ˆë‹¤.

### ì‹¤í–‰ ìˆœì„œ

```
Milestone 1 (Detection)
    â†“
Milestone 2 (Backup/Restore)
    â†“
Milestone 3 (UI í†µí•©)
    â†“
Milestone 4 (í†µí•© ë° í…ŒìŠ¤íŠ¸)
```

### ìš°ì„ ìˆœìœ„

1. **ìµœê³  ìš°ì„ ìˆœìœ„**: Milestone 1, 2 (í•µì‹¬ ë°±ì—…/ë³µì› ë¡œì§)
2. **ë†’ì€ ìš°ì„ ìˆœìœ„**: Milestone 3, 4 (UI ë° í†µí•©)

### ì˜ì¡´ì„±

- Milestone 2ëŠ” Milestone 1 ì™„ë£Œ í›„ ì‹œì‘
- Milestone 3ì€ Milestone 2 ì™„ë£Œ í›„ ì‹œì‘
- Milestone 4ëŠ” Milestone 1-3 ì™„ë£Œ í›„ ì‹œì‘

---

## ğŸ“š ì°¸ì¡° ë¬¸ì„œ

- **SPEC-UPDATE-001**: [spec.md](./spec.md) - ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ
- **EARS ë°©ë²•ë¡ **: MoAI-ADK ê°œë°œ ê°€ì´ë“œ
- **TRUST 5 ì›ì¹™**: í’ˆì§ˆ ê¸°ì¤€ (Test-first, Readable, Unified, Secured, Trackable)
- **questionary ë¬¸ì„œ**: https://questionary.readthedocs.io/
- **rich ë¬¸ì„œ**: https://rich.readthedocs.io/

---

**END OF PLAN**
